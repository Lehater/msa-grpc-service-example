# Отчет с полным описанием шагов выполнения, приложенными диаграммами и описанием каждого микросервиса

## 1. Выбор системы:

> - Выберите систему или приложение, которое вы будете проектировать.

Для проектирования была выбрана система онлайн-торговли, которая предоставляет возможность пользователям просматривать
товары, оформлять заказы и осуществлять платежи.

---

## 2. Анализ функциональности:

> - Составьте список ключевых функций вашей системы.
> - Выделите независимые модули для каждой функции.

### Список ключевых функций системы

1. **Управление пользователями:**
    - Регистрация и аутентификация пользователей.
    - Управление профилем пользователя.
    - Авторизация для выполнения действий в системе.

2. **Управление каталогом товаров:**
    - Хранение данных о товарах.
    - Поиск и фильтрация товаров.
    - Обновление информации о товарах.

3. **Обработка заказов:**
    - Создание и управление заказами.
    - Проверка наличия товаров в заказе.
    - Резервирование товаров на складе.
    - Отслеживание статуса заказов.

4. **Обработка платежей:**
    - Проведение платежей через платёжные шлюзы.
    - Проверка статуса транзакций.
    - Управление возвратами и отказами.

5. **Управление запасами:**
    - Мониторинг остатков товаров на складе.
    - Обновление данных о наличии товаров.
    - Интеграция с поставщиками для пополнения запасов.

6. **Уведомления:**
    - Отправка уведомлений пользователям о статусах заказов.
    - Внутренние уведомления для сервисов.

7. **Аналитика:**
    - Сбор и хранение данных о продажах и действиях пользователей.
    - Формирование отчётов.
    - Передача данных в аналитические платформы.

### Независимые модули для каждой функции

1. **Модуль управления пользователями:**
    - Реализация регистрации, аутентификации и управления профилем пользователей.

2. **Модуль управления каталогом:**
    - Управление данными о товарах, их поиском и обновлением.

3. **Модуль обработки заказов:**
    - Логика создания, проверки и управления заказами, а также резервирования товаров.

4. **Модуль обработки платежей:**
    - Управление интеграцией с платёжными шлюзами и обработка транзакций.

5. **Модуль управления запасами:**
    - Контроль остатков, взаимодействие с поставщиками и обновление данных о складе.

6. **Модуль уведомлений:**
    - Отправка внутренних и внешних уведомлений пользователям и сервисам.

7. **Модуль аналитики:**
    - Сбор данных, их хранение и предоставление в виде аналитических отчётов.

---

## 3. Выделение микросервисов:

> - Создайте два микросервиса, которые решают определенную задачу, будь то управления платежами или обработки заказов.
> - Каждый микросервис должен **имитировать** одну из следующих функциональностей.
    >

- Сервис обработки заказов: обрабатывает заказы от пользователей.

> - Сервис управления платежами: отвечает за финансирование и транзакции.
    >

- Сервис отслеживания состояния: позволяет пользователям отслеживать состояние своих заказов.

> - Сервис отзывов: позволяет пользователям оставлять и читать отзывы.
> - Убедитесь, что микросервисы минимально зависят друг от друга.

### Микросервисы системы

1. **Микросервис управления пользователями (User Service):**
    - Регистрация пользователей.
    - Аутентификация и авторизация.
    - Управление профилем пользователя.

2. **Микросервис управления каталогом (Catalog Service):**
    - Хранение данных о товарах.
    - Обновление информации о товарах.
    - Поиск и фильтрация товаров.

3. **Микросервис обработки заказов (Order Service):**
    - Создание и управление заказами.
    - Проверка наличия товаров.
    - Резервирование товаров на складе.
    - Отслеживание статуса заказов.

4. **Микросервис обработки платежей (Payment Service):**
    - Проведение платежей через платёжные шлюзы.
    - Проверка и подтверждение транзакций.
    - Управление возвратами и отказами.

5. **Микросервис управления запасами (Inventory Service):**
    - Мониторинг остатков товаров.
    - Резервирование товаров на складе.
    - Интеграция с поставщиками для пополнения запасов.

6. **Микросервис уведомлений (Notification Service):**
    - Отправка уведомлений пользователям (email/SMS).
    - Внутренние уведомления между сервисами.

7. **Микросервис аналитики (Analytics Service):**
    - Сбор данных о заказах, продажах и пользователях.
    - Формирование аналитических отчётов.
    - Передача данных в аналитические платформы.

8. **API Gateway:**
    - Единая точка входа для всех запросов.
    - Маршрутизация запросов между микросервисами.
    - Обеспечение безопасности через проверку токенов.

Каждый из микросервисов будет автономным, со своими собственными базами данных и интерфейсами, что обеспечит минимальную
связанность.

### Микросервисы, выбранные для реализации **имитации** функциональностей системы

Для реализации gRPC взаимодействия между микросервисами выбраны следующие два микросервиса:

- **Микросервис обработки заказов (Order Service):**
    - Создание и управление заказами.
    - Проверка наличия товаров.
    - Резервирование товаров на складе.
    - Отслеживание статуса заказов.

- **Микросервис обработки платежей (Payment Service):**
    - Проведение платежей через платёжные шлюзы.
    - Проверка и подтверждение транзакций.
    - Управление возвратами и отказами.

---

## 4. Определение интерфейсов взаимодействия:

> - Создайте файлы .proto для каждого сервиса
> - Определите gRPC методы для каждого сервиса, включая запросы и ответы.
> - Используйте сериализацию данных в формате Protocol Buffers.

### Определение интерфейсов взаимодействия для gRPC

### 1. **Файл `.proto` для Order Service**

Определим интерфейсы для микросервиса обработки заказов.

```proto
syntax = "proto3";

package order;

service OrderService {
  // Создание нового заказа
  rpc CreateOrder(CreateOrderRequest) returns (CreateOrderResponse);
  
  // Получение информации о заказе
  rpc GetOrder(GetOrderRequest) returns (GetOrderResponse);
  
  // Обновление статуса заказа
  rpc UpdateOrderStatus(UpdateOrderStatusRequest) returns (UpdateOrderStatusResponse);
}

message CreateOrderRequest {
  string user_id = 1; // ID пользователя
  repeated OrderItem items = 2; // Список товаров
}

message CreateOrderResponse {
  string order_id = 1; // ID созданного заказа
  string status = 2; // Статус заказа
}

message GetOrderRequest {
  string order_id = 1; // ID заказа
}

message GetOrderResponse {
  string order_id = 1;
  string user_id = 2;
  repeated OrderItem items = 3;
  string status = 4;
}

message UpdateOrderStatusRequest {
  string order_id = 1; // ID заказа
  string new_status = 2; // Новый статус заказа
}

message UpdateOrderStatusResponse {
  string order_id = 1;
  string updated_status = 2; // Обновлённый статус заказа
}

message OrderItem {
  string product_id = 1; // ID товара
  int32 quantity = 2; // Количество
  float price = 3; // Цена за единицу
}
```

### 2. **Файл `.proto` для Payment Service**

Определим интерфейсы для микросервиса обработки платежей.

```proto
syntax = "proto3";

package payment;

service PaymentService {
  // Проведение платежа
  rpc ProcessPayment(ProcessPaymentRequest) returns (ProcessPaymentResponse);

  // Проверка статуса транзакции
  rpc GetTransactionStatus(GetTransactionStatusRequest) returns (GetTransactionStatusResponse);
}

message ProcessPaymentRequest {
  string order_id = 1; // ID заказа
  float amount = 2; // Сумма платежа
  string payment_method = 3; // Метод оплаты (например, "credit_card")
}

message ProcessPaymentResponse {
  string transaction_id = 1; // ID транзакции
  string status = 2; // Статус транзакции (например, "SUCCESS", "FAILED")
}

message GetTransactionStatusRequest {
  string transaction_id = 1; // ID транзакции
}

message GetTransactionStatusResponse {
  string transaction_id = 1; // ID транзакции
  string status = 2; // Текущий статус (например, "PENDING", "SUCCESS")
  string reason = 3; // Причина отказа (если применимо)
}
```

### **Пояснения:**

1. **Формат данных:**
    - **Protocol Buffers** для сериализации данных.

2. **gRPC методы:**
    - **Order Service:**
        - `CreateOrder` — для создания нового заказа.
        - `GetOrder` — для получения данных о заказе.
        - `UpdateOrderStatus` — для обновления статуса заказа.
    - **Payment Service:**
        - `ProcessPayment` — для проведения платежа.
        - `GetTransactionStatus` — для получения информации о статусе транзакции.

3. **Взаимодействие между сервисами:**
    - Order Service вызывает `ProcessPayment` из Payment Service для проведения платежа.
    - Payment Service уведомляет Order Service о результатах транзакции (например, через событие или синхронный ответ).

---

## 5. Настройка инфраструктуры с Docker:

> - Создайте Dockerfile для каждого микросервиса, указывая необходимые зависимости.
> - Напишите файл docker-compose.yml для развертывания всех сервисов вместе, включая их зависимости и конфигурации

---

## 6. Развертывание и тестирование:

> - Используйте Postman или gRPC client для тестирования взаимодействия между сервисами

---

### Ожидаемый результат

> - Развернутая система: все микросервисы развернуты и работают в Docker-контейнерах.
> - Тестовое взаимодействие: успешные тесты на gRPC вызовы между сервисами.
> - Отчет с полным описанием шагов выполнения, приложенными диаграммами и описанием каждого микросервиса в формате PDF.
